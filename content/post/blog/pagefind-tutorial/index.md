---
title: "ä¸ºä½ çš„åšå®¢åˆ›å»ºæœç´¢å¼•æ“â€”â€”Pagefindæ­å»ºæŒ‡åŒ—"
date: 2023-03-12T22:47:34+08:00
description: "èŠèŠéCSé€‰æ‰‹æ˜¯å¦‚ä½•æŠ˜è…¾å‰ç«¯çš„"
tags: ["æŠ˜è…¾"]
keywords: ["Pagefind"]
categories: ["åšå®¢"]
image: "https://mitcher-1316637614.cos.ap-nanjing.myqcloud.com/test/image-20230313001534638.png"
author: "Mitcher"
rss_ignore: false
draft: false
---



## å†™åœ¨å‰é¢

ä¸Šå‘¨å…­é—²ç€ä¹Ÿæ˜¯é—²ç€ï¼Œäºæ˜¯å¯»æ€é¡ºä¾¿åœ¨åŸæ¥çš„ä¸»é¢˜åŠ å…¥æœç´¢å¼•æ“ï¼Œä»¥æ›´å¥½æ•´ç†æ—¥åçš„å†…å®¹ã€‚å› ä¸ºä¹‹å‰ï¼ˆç›´åˆ°æ˜¨å¤©ï¼‰è¿˜æ˜¯åœ¨ç”¨[Pseudoyu](www.pseudoyu.com)çš„é…ç½®æ–‡ä»¶ï¼Œçœ‹åˆ°yuä»‹ç»è‡ªå·±æ­å»ºè¿‡ç¨‹çš„æ—¶å€™æ¯”è¾ƒè½»ææ·¡å†™ï¼ŒåŠ ä¸Šä¹‹å‰æœ‰ä½¿ç”¨Cusdisçš„ä¸€äº›ç»éªŒï¼Œäºæ˜¯äº§ç”Ÿäº†åº”è¯¥ä¸æ˜¯å¾ˆéš¾çš„é”™è§‰ã€‚æœ¬ç¯‡çš„çœæµç‰ˆæœ¬å¯è§äº[ä¸ºä½ çš„åšå®¢åˆ›å»ºæœç´¢å¼•æ“â€”â€”è°ˆè°ˆæˆ‘åœ¨æ­å»ºPagefindæ—¶è¸©è¿‡çš„å‘](https://www.huang-zifeng.com/p/ä¸ºä½ çš„åšå®¢åˆ›å»ºæœç´¢å¼•æ“è°ˆè°ˆæˆ‘åœ¨æ­å»ºpagefindæ—¶è¸©è¿‡çš„å‘/)ã€‚
<!--more-->

## localhost

é¦–å…ˆåº”è¯¥æ˜¯åœ¨layouts/shortcodesä¸­åˆ›å»ºsearch.htmlï¼Œåœ¨å…¶ä¸­æ”¾å…¥æ¥è‡ª[Getting Started with Pagefind](https://pagefind.app/docs/)çš„htmlä»£ç ï¼š

```html
<link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/_pagefind/pagefind-ui.js" type="text/javascript"></script>
<div id="search"></div>
<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search" });
    });
</script>
```

ä»¥æ–¹ä¾¿åé¢æˆ‘ä»¬åœ¨å†™Markdownçš„æ—¶å€™é€šè¿‡å…³é”®å­—`search`å¿«é€ŸåµŒå…¥é¡µé¢ç‰ˆå¼ã€‚

ç„¶åå°±æ˜¯åœ¨`Bash`å¯¹æœ¬åœ°æ–‡ä»¶è¿›è¡Œç´¢å¼•ï¼ŒæŸ¥çœ‹æ•ˆæœï¼š

```
npx -y pagefind --source public --serve
```

ä¸Šé¢è¿™è¡Œå‘½ä»¤çš„æ„æ€æ˜¯, ä½¿ç”¨`npx`å®‰è£…pagefindï¼Œ-yè¡¨ç¤ºå¦‚æœæœ¬åœ°æ²¡æœ‰å®‰è£…é»˜è®¤åŒæ„å®‰è£…ï¼Œ`--source public`è¡¨ç¤ºå¯¹publicæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶è¿›è¡Œç´¢å¼•, --serveè¡¨ç¤ºç´¢å¼•å®Œä¹‹åç›´æ¥å¯åŠ¨æœ¬åœ°ç«¯è°ƒè¯•ã€‚

å…¶ä¸­é‡åˆ°çš„å›°éš¾æ˜¯ï¼Œå®‰è£…çš„æ—¶å€™ä¼šæ˜¾ç¤º`æ­£åœ¨å†™å…¥æ•°æ®æµ`ï¼Œå†™å…¥å®Œä¹‹åå°±ä¸äº†äº†ä¹‹äº†ï¼Œè¿™åœ¨GitHubä¸Šé¢æœ‰äººæè¿‡issueï¼Œæˆ‘å½“æ—¶è¿˜æ²¡æœ‰å»çœ‹ï¼Œåªæ˜¯é€šè¿‡è¯¢é—®New BingçŸ¥é“äº†è¿™ç§æƒ…å†µå¯èƒ½æ˜¯ç»ˆç«¯ä¸å…¼å®¹çš„é—®é¢˜ï¼ˆå½“æ—¶ç”¨çš„æ˜¯Bashï¼‰,åé¢æ¢æˆå‘½ä»¤è¡Œå·¥å…·å°±å¥½äº†ã€‚

æ‰§è¡Œç´¢å¼•çš„é‚£æ¡å‘½ä»¤ï¼Œå¦‚æœæŒ‰ç…§æ•™ç¨‹åŠ ä¸Š--serveæŒ‰ç†è¯´åº”è¯¥ä¼šçœ‹åˆ°æœ¬åœ°çš„æ˜¾ç¤ºæ•ˆæœæ‰å¯¹ï¼Œwhileå®ƒä¼šé‡å®šå‘åˆ°ä½ `baseurl`æ‰€æŒ‡å‘çš„åœ°å€ï¼Œæ‰€ä»¥ä½ æ— æ³•åœ¨æœ¬åœ°ç«¯è°ƒè¯•ã€‚

æ¥ä¸‹æ¥ç¬”è€…ç‚¹äº†ä¸€ä¸ªæŠ€èƒ½æ ‘ï¼Œå‘ç°æœ‰ä¸€ä¸ªPseudoyuçš„ä»“åº“é‡Œæœ‰ä¸ªShellè„šæœ¬æ–‡ä»¶`startpf.sh`å¯ä»¥ç›´æ¥ä¸€æ¬¡æ€§æ‰§è¡Œä¸Šé¢çš„ä¸‰è¡Œä»£ç ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æœ¬åœ°æ˜¾ç¤ºæ•ˆæœã€‚

å†…å®¹æ˜¯

```shell
hugo
npm_config_yes=true npx pagefind --source "public" --bundle-dir ../static/mysearch
hugo server
```

è‡³æ­¤ï¼Œä½ åº”è¯¥å®Œæˆäº†æœ¬åœ°ç«¯çš„è°ƒè¯•ã€‚åœ¨æœ¬åœ°ç«¯çœ‹è§äº†æ•ˆæœï¼š

![localhost](https://mitcher-1316637614.cos.ap-nanjing.myqcloud.com/test/image-20230313001534638.png)

## CI

æ¥ä¸‹æ¥æ˜¯GitHub Actionä¸Šè‡ªåŠ¨æ‰§è¡Œå·¥ä½œæµï¼ŒåŸæœ¬æƒ³çš„å¾ˆç®€å•çš„ï¼Œå°±å’Œç™½æ±¤å››ç‰©[è½»ææ·¡å†™](https://www.fournoas.com/posts/adding-full-text-search-to-a-hugo-static-website/)èˆ¬çš„ä¸€æ ·ã€‚

> ç¼–è¾‘ .github/workflows/hugo.yml æ–‡ä»¶ï¼Œåœ¨ steps å°ç»“ä¸­çš„ Build å’Œ Deploy æ“ä½œä¹‹é—´æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š
```yaml
   name: Install nodejs
    uses: actions/setup-node@v3
    with:
      node-version: 18
   run: npm i pagefind
   run: npx pagefind --source public --bundle-dir search
```
å¯¹äºå¤§å¤šæ•°äººæ¥è¯´ï¼Œéƒ¨ç½²Pagefindå·²ç»å°±æ­¤å®Œæˆäº†ã€‚å¦‚æœåªæ˜¯è¿™æ ·ï¼Œä½œä¸ºä¸€æ¬¾é™æ€ç½‘ç«™æœç´¢å¼•æ“å·¥å…·ï¼ŒPagefindç¡®å®è¶³å¤Ÿä¼˜ç§€ï¼Œè½»é‡åŒ–ã€‚

## Troubleshoot

ä½†æ˜¯å‘ç°æ‰€æœ‰workflowéƒ½æ²¡æœ‰æŠ¥é”™ä¹‹åï¼Œåœ¨ç½‘ç«™ä¾ç„¶çœ‹ä¸è§æœç´¢æ¡†UIã€‚

æ¥ä¸‹æ¥çš„ä¸‰å¤©æ²¡æŠ˜è…¾ä»€ä¹ˆï¼Œå°±æ˜¯å¯¹ç€`deploy.yml`åå¤è¿›è¡Œä¸Šç™¾æ¬¡çš„ä¿®æ”¹ï¼ˆæ­¤å¤„æ˜¯å¿ƒç¢çš„å£°éŸ³ğŸ’”ï¼‰

ç›´æ¥è¯´ç»“è®ºï¼Œä¸ºä»€ä¹ˆWorkflowæ²¡æœ‰æŠ¥é”™ï¼Œä½†æ˜¯UIæ²¡æœ‰æ˜¾ç¤ºå‘¢ã€‚

æˆ‘åœ¨GitHubä¸Šé¢æé—®äº†ä½œè€…[bglw](https://github.com/bglw)ï¼Œå¾—åˆ°çš„å›å¤æ˜¯DOMContentLoadedå‘ç”Ÿçš„æ—¶é—´å¤ªå¿«ï¼Œå› æ­¤`window.addEventListener`æ ¹æœ¬æ¥ä¸åŠè¿è¡Œï¼Œå‘ƒå‘ƒå‘ƒå‘ƒï¼Œåªèƒ½è¯´å¯¹äºä½œä¸ºéå‰ç«¯å¼€å‘çš„ç¬”è€…æ ¹æœ¬çœ‹ä¸å‡ºæ¥å¯ä»¥è¿™æ ·debugå¥½å§ã€‚åé¢åœ¨markdownçš„searchæ ‡ç­¾ä¸‹åŠ å…¥äº†scriptã€‚

```html
<script defer> new PagefindUI({ element: "#search" }) </script>
```

æ„æ€æ˜¯å¼ºåˆ¶æ‰§è¡Œè¿™è¡Œä»£ç ï¼Œè¿˜æ˜¯ç”¨äº†`defer`è¿›è¡Œå»¶åã€‚

ä¹‹åå†çœ‹çœ‹å¼€å‘è€…æ¨¡å¼ï¼Œæœç„¶è·³å‡ºæ¥äº†å°ä¸‘ï¼ˆæ£è›‹é¬¼ğŸ‘»ï¼‰

å¤§æ¦‚æ˜¯"rocket-loader.css"åŠ è½½é”™è¯¯ã€‚

è¿™ä¸ªæ°æ°æ˜¯Cloudflareçš„ä¸€é¡¹åŠ é€ŸæœåŠ¡ã€‚å› è€Œå¾ˆå®¹æ˜“æƒ³åˆ°ä¸ºä»€ä¹ˆDOMContentLoadedå‘ç”Ÿçš„æ—¶é—´ä¼šå¤ªå¿«ã€‚

äºæ˜¯å…³é—­è¿™é¡¹æœåŠ¡ä¹‹åï¼Œç­‰äº†å››å¤©çš„ç»“æœç»ˆäºå‡ºç°äº†ã€‚è‡³æ­¤ï¼Œè¸©çš„å‘å·²ç»åˆ†äº«å®Œæˆã€‚

